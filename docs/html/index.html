<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>wlog: Титульная страница</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">wlog
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Создано системой Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Титульная&#160;страница</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">wlog Документация</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Библиотека логирования и WFC-фреймворка, с большими возможностями кастомизации с помощью опций, обработчиков и конфигурационного файла в формате JSON.</p>
<div class="image">
<img src="https://i.imgur.com/xdC2tVt.png"  alt="wlog"/>
</div>
<p>Документация <a href="https://mambaru.github.io/wlog/index.html">doxygen</a>. Репозитарий на <a href="https://github.com/mambaru/wlog">github.com</a>. Отчет <a href="https://mambaru.github.io/wjson/cov-report/index.html">coverage</a></p>
<p>Каждая строка лога состоит из временной отметки, имени лога (по умолчанию WLOG), типа сообщения и текста сообщения. Запись в лог осуществляется с помощью набора макросов, например: </p><div class="fragment"><div class="line"><span class="preprocessor">#define WLOG_ENABLE_DEBUG_LOG // Don&#39;t disable DEBUG and TRACE in Release </span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;wlog/wlog.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;wlog/init.hpp&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  wlog::init(<span class="stringliteral">&quot;example.log&quot;</span>); </div><div class="line">  WLOG_MESSAGE( <span class="stringliteral">&quot;Example N&quot;</span> &lt;&lt; 1 &lt;&lt; <span class="stringliteral">&quot; message&quot;</span> )</div><div class="line">  WLOG_WARNING( &quot;Example N&quot; &lt;&lt; 1 &lt;&lt; &quot; warning&quot; )</div><div class="line">  WLOG_ERROR( &quot;Example N&quot; &lt;&lt; 2 &lt;&lt; &quot; error&quot; )</div><div class="line">  WLOG_DEBUG( &quot;Example N&quot; &lt;&lt; 3 &lt;&lt; &quot; debug&quot; )</div><div class="line">  WLOG_TRACE( &quot;Example N&quot; &lt;&lt; 4 &lt;&lt; &quot; trace&quot; )</div><div class="line">  return 0;</div><div class="line">}</div></div><!-- fragment --><p> По умолчанию сообщения DEBUG и TRACE отключаются на уровне препроцессора в Release режиме.</p>
<h1>Системные требования и особенности</h1>
<ul>
<li>linux</li>
<li>g++ 4.7 и выше, clang++</li>
<li>cmake 2.8 и выше</li>
<li>Стандарт c++11</li>
<li>thread-safe</li>
<li>Запись в файлы, stdout и syslog</li>
<li><b>Не</b> header-only</li>
<li>Большие возможности кастомизации форматирования и ротирования как на уровне конфигурации, так и с помощью программных обработчиков</li>
<li>Можно писать наборы логов в разные файлы с различным форматированием (в том числе stdout) и режимами ротации</li>
<li>Динамическое реконфигурирование в любой момент времени</li>
<li>Поддержка JSON-конфигурации с комментариями в Си-стиле</li>
</ul>
<h1>Сборка и установка</h1>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;make shared &amp;&amp; sudo make install</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;make static &amp;&amp; sudo make install</div></div><!-- fragment --><p>Для сборки примеров и тестов, а также чтобы отключить поддержку JSON-конфигурации:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;git clone https://github.com/mambaru/wlog.git</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;mkdir wlog/build</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;cd wlog/build</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;cmake ..</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;# Для сборки примеров и тестов</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;cmake -DBUILD_TESTING=ON ..</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;# Если поддержка JSON не требуется </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;cmake -DWLOG_DISABLE_JSON=ON ..</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;cmake --build make</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;ctest </div></div><!-- fragment --><p>Для компиляции с поддержкой JSON-конфигурации потребуются header-only библиотеки wjson и faslib, которые система сборки автоматически клонирует в директорию сборки, если не найдет их в системе или на том же уровне файловой системы, куда вы клонировали wlog, но для использования они не нужны.</p>
<h2>Подключение как submodule</h2>
<p>main.cpp: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;wlog/logging.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;wlog/init.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;wlog/load.hpp&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  wlog::init(wlog::load(<span class="stringliteral">&quot;{}&quot;</span>));</div><div class="line">  WLOG_MESSAGE(<span class="stringliteral">&quot;Hello&quot;</span>)</div><div class="line">}</div></div><!-- fragment --><h3>Если нужен только wlog</h3>
<p>CMakeLists.txt: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cmake_minimum_required(VERSION 2.8)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;set(CMAKE_CXX_FLAGS &quot;-std=c++11&quot;)</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;add_subdirectory(wlog)</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;add_executable(main main.cpp)</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;include_directories(wlog)</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;target_link_libraries(main wlog)</div></div><!-- fragment --><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;git init</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;git submodule add https://github.com/mambaru/wlog.git</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;mkdir build</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;cd build</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;cmake ..</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;make</div></div><!-- fragment --><h3>С подключение faslib и wjson</h3>
<p>CMakeLists.txt: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cmake_minimum_required(VERSION 2.8)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;set(CMAKE_CXX_FLAGS &quot;-std=c++11&quot;)</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;add_subdirectory(faslib)</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;add_subdirectory(wjson)</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;add_subdirectory(wlog)</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;include_directories(wlog wjson faslib)</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;add_executable(main main.cpp)</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;target_link_libraries(main wlog)</div></div><!-- fragment --><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;git init</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;git submodule add https://github.com/migashko/faslib.git</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;git submodule add https://github.com/mambaru/wjson.git</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;git submodule add https://github.com/mambaru/wlog.git</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;mkdir build</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;cd build</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;cmake ..</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;make</div></div><!-- fragment --><h1>Инициализация</h1>
<p>Если не вызвать <code>wlog::init</code> то вывод будет на экран без форматирования и синхронизации. Вызывать <code>wlog::init</code> можно в любое время в любом месте, а также повторно для реконфигурации.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;wlog/init.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;wlog/load.hpp&gt;</span></div><div class="line"></div><div class="line">  <span class="comment">// По умолчанию вывод только в clog в цвете</span></div><div class="line">  wlog::init();</div><div class="line">  <span class="comment">// Выводить с тысячными долями секунд и отключить цветовую раскраску </span></div><div class="line">  wlog::init(wlog::resolutions::milliseconds, wlog::colorized_flags::none);</div><div class="line">  <span class="comment">// Выводить в файл и clog</span></div><div class="line">  wlog::init(<span class="stringliteral">&quot;main.log&quot;</span>);</div><div class="line">  <span class="comment">// Выводить с тысячными долями секунд в файл и clog и отключить цветовую раскраску для clog</span></div><div class="line">  wlog::init(<span class="stringliteral">&quot;main.log&quot;</span>, wlog::resolutions::milliseconds, wlog::colorized_flags::none);</div><div class="line"></div><div class="line">  <span class="comment">// Так можно задать все остальные опции</span></div><div class="line">  wlog::logger_options opt;</div><div class="line">  opt.path=<span class="stringliteral">&quot;main.log&quot;</span>;</div><div class="line">  wlog::init(opt);</div><div class="line"></div><div class="line">  <span class="comment">// Загрузить конфигурацию из файла</span></div><div class="line">  wlog::init(wlog::load(<span class="stringliteral">&quot;logger.json&quot;</span>));</div><div class="line">  <span class="comment">// Загрузить конфигурацию из строки</span></div><div class="line">  wlog::init(wlog::load(<span class="stringliteral">&quot;{\&quot;path\&quot;:\&quot;main.log\&quot;}&quot;</span>));</div><div class="line"></div><div class="line">  <span class="comment">// Вариант с проверкой </span></div><div class="line">  std::string err;</div><div class="line">  opt = wlog::logger_options();</div><div class="line">  <span class="keywordflow">if</span> ( wlog::load(<span class="stringliteral">&quot;logger.json&quot;</span>, &amp;opt, &amp;err) )</div><div class="line">    wlog::init(opt);</div><div class="line">  <span class="keywordflow">else</span></div><div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;ERROR: &quot;</span> &lt;&lt; err &lt;&lt; std::endl;</div></div><!-- fragment --><p>Для вывода финального сообщения при завершении работы: </p><div class="fragment"><div class="line"><span class="comment">// Выключаем логирование </span></div><div class="line"><span class="keywordflow">if</span> (<span class="keyword">auto</span> log = wlog::release() )</div><div class="line">{</div><div class="line">  <span class="comment">// Глобальный лог уже не доступен</span></div><div class="line">  <span class="comment">// Но можем записать в лог финальное сообщение</span></div><div class="line">  log( wlog::time_point::clock::now(), <span class="stringliteral">&quot;EXAMPLE4&quot;</span>, <span class="stringliteral">&quot;FINAL&quot;</span>, <span class="stringliteral">&quot;Bye!\n&quot;</span> );</div><div class="line">}</div></div><!-- fragment --><p> Это может быть полезно, если нужна гарантия, что сообщение будет последним в файле лога (например, в многопоточной среде, и/или много отладочных сообщений в деструкторах объектов)</p>
<h1>Использование</h1>
<p>В каждом сообщении лога присутствуют четыре основные элемента, которые можно кастомизировать или скрывать:</p>
<ul>
<li>Дата и время + доли секунды</li>
<li>Имя лога</li>
<li>Тип сообщения:<ul>
<li>ERROR - ошибки, после которых система сохраняет работоспособность и согласованность данных</li>
<li>WARNING - предупреждения, например о превышении размера очереди.</li>
<li>MESSAGE - прочие уведомления</li>
<li>FATAL - фатальная ошибка. Обычно далее следует останов системы</li>
<li>BEGIN - начало какого либо процесса (например загрузка БД)</li>
<li>END - окончание какого либо процесса (например загрузка БД)</li>
<li>DEBUG - отладочные сообщения (отключается в релиз-версии на уровне препроцессора )</li>
<li>TRACE - трассировка ввода/вывода (отключается в релиз-версии на уровне препроцессора )</li>
<li>PROGRESS - трассировка прогресса длительных операций без перевода строки (например процент загрузки БД)</li>
</ul>
</li>
<li>Сообщение. Произвольный формат</li>
</ul>
<p>По умолчанию используется лог WLOG в соответствующем наборе макросов:</p>
<div class="fragment"><div class="line"><span class="comment">//wlog/logging.hpp</span></div><div class="line"><span class="preprocessor">#define WLOG_ERROR(X)    WLOG_LOG_ERROR   ( &quot;WLOG&quot;, X )</span></div><div class="line"><span class="preprocessor">#define WLOG_WARNING(X)  WLOG_LOG_WARNING ( &quot;WLOG&quot;, X )</span></div><div class="line"><span class="preprocessor">#define WLOG_MESSAGE(X)  WLOG_LOG_MESSAGE ( &quot;WLOG&quot;, X )</span></div><div class="line"><span class="preprocessor">#define WLOG_FATAL(X)    WLOG_LOG_FATAL   ( &quot;WLOG&quot;, X )</span></div><div class="line"><span class="preprocessor">#define WLOG_BEGIN(X)    WLOG_LOG_BEGIN   ( &quot;WLOG&quot;, X )</span></div><div class="line"><span class="preprocessor">#define WLOG_END(X)      WLOG_LOG_END     ( &quot;WLOG&quot;, X )</span></div><div class="line"><span class="preprocessor">#define WLOG_DEBUG(X)    WLOG_LOG_DEBUG   ( &quot;WLOG&quot;, X )</span></div><div class="line"><span class="preprocessor">#define WLOG_TRACE(X)    WLOG_LOG_TRACE   ( &quot;WLOG&quot;, X )</span></div><div class="line"><span class="preprocessor">#define WLOG_PROGRESS(X) WLOG_LOG_PROGRESS( &quot;WLOG&quot;, X )</span></div></div><!-- fragment --><p> Аналогичным образом можно сделать свой набор макросов для каждого лога. Если не устраивает предлагаемых сообщений, то можно задать свой, аналогично набору макросов для работы с syslog:</p>
<div class="fragment"><div class="line"><span class="comment">//wlog/logging.hpp</span></div><div class="line"><span class="preprocessor">#define WSYSLOG_EMERG(X)   WLOG( &quot;SYSLOG&quot;, &quot;EMERG&quot;,   X)</span></div><div class="line"><span class="preprocessor">#define WSYSLOG_ALERT(X)   WLOG( &quot;SYSLOG&quot;, &quot;ALERT&quot;,   X)</span></div><div class="line"><span class="preprocessor">#define WSYSLOG_CRIT(X)    WLOG( &quot;SYSLOG&quot;, &quot;CRIT&quot;,    X)</span></div><div class="line"><span class="preprocessor">#define WSYSLOG_ERR(X)     WLOG( &quot;SYSLOG&quot;, &quot;ERR&quot;,     X)</span></div><div class="line"><span class="preprocessor">#define WSYSLOG_WARNING(X) WLOG( &quot;SYSLOG&quot;, &quot;WARNING&quot;, X)</span></div><div class="line"><span class="preprocessor">#define WSYSLOG_NOTICE(X)  WLOG( &quot;SYSLOG&quot;, &quot;NOTICE&quot;,  X)</span></div><div class="line"><span class="preprocessor">#define WSYSLOG_INFO(X)    WLOG( &quot;SYSLOG&quot;, &quot;INFO&quot;,    X)</span></div><div class="line"><span class="preprocessor">#define WSYSLOG_DEBUG(X)   WLOG( &quot;SYSLOG&quot;, &quot;DEBUG&quot;,   X)</span></div></div><!-- fragment --><p> Пример использования: </p><div class="fragment"><div class="line">WLOG_MESSAGE(<span class="stringliteral">&quot;Это &quot;</span> &lt;&lt; 10 &lt;&lt; <span class="stringliteral">&quot; сообщение&quot;</span> )</div><div class="line">WLOG_ERROR(&quot;Это &quot; &lt;&lt; 25 &lt;&lt; &quot; ошибка&quot; )</div></div><!-- fragment --><h1>Конфигурирование</h1>
<p>Здесь и далее будут приводиться примеры конфигурации в JSON-формате. Имена полей полностью совпадают с полями структур конфигурации. В неочевидных случаях, например при использовании перечислений, будут приведены примеры на C++. JSON-конфигурация, со значениями по умолчанию. Если значения по умолчанию вас устраивают, то эти поля можно удалять: </p><div class="fragment"><div class="line">{</div><div class="line">  <span class="comment">/* Список доступных логов и типов сообщений */</span></div><div class="line">  <span class="stringliteral">&quot;allow&quot;</span>: [],</div><div class="line">  <span class="comment">/* Список запрещенных логов и типов сообщений */</span></div><div class="line">  <span class="stringliteral">&quot;deny&quot;</span>: [],</div><div class="line">  <span class="comment">/* Путь к файлу лога */</span></div><div class="line">  <span class="stringliteral">&quot;path&quot;</span>: <span class="stringliteral">&quot;&quot;</span>,</div><div class="line">  <span class="comment">/* Синхронная запись (открыть-записать-закрыть) */</span></div><div class="line">  <span class="stringliteral">&quot;sync&quot;</span>: <span class="keyword">true</span>,</div><div class="line"></div><div class="line">  <span class="comment">/* --- Опции ротации --- */</span></div><div class="line"></div><div class="line">  <span class="comment">/* Начинать лог с начала файла (старый лог сохраняется, если задан rotation) */</span></div><div class="line">  <span class="stringliteral">&quot;startup_rotate&quot;</span>: <span class="keyword">false</span>,</div><div class="line">  <span class="comment">/* Ограничение лога по размеру (в байтах) */</span></div><div class="line">  <span class="stringliteral">&quot;size_limit&quot;</span>: 0,</div><div class="line">  <span class="comment">/* Ограничение лога по времени (в секундах) */</span></div><div class="line">  <span class="stringliteral">&quot;time_limit&quot;</span>: 0,</div><div class="line">  <span class="comment">/* Включить сохранение логов при ротации (макс. кол-во файлов) */</span></div><div class="line">  <span class="stringliteral">&quot;rotation&quot;</span>: 0,</div><div class="line">  <span class="comment">/* Сопроводительное сообщение ротирование в начале файла */</span></div><div class="line">  <span class="stringliteral">&quot;rotation_header&quot;</span>: <span class="keyword">true</span>,</div><div class="line">  <span class="comment">/* Сопроводительное сообщение ротирование в конце файла */</span></div><div class="line">  <span class="stringliteral">&quot;rotation_footer&quot;</span>: <span class="keyword">true</span>,</div><div class="line">  <span class="comment">/* По умолчание к имени файла добавляется внутренний счетчи, если указать эту функцию - то unixtime*/</span></div><div class="line">  <span class="stringliteral">&quot;unixtime_suffix&quot;</span>: <span class="keyword">false</span>,</div><div class="line"></div><div class="line">  <span class="comment">/* --- Опции форматирования --- */</span></div><div class="line">  <span class="comment">// Ширина поля имени лога (в символах)</span></div><div class="line">  <span class="stringliteral">&quot;name_width&quot;</span>: 6,</div><div class="line">  <span class="comment">// Ширина поля типа сообщения (в символах)</span></div><div class="line">  <span class="stringliteral">&quot;ident_width&quot;</span>: 9,</div><div class="line">  <span class="comment">/* Точность отображения времени (от наносекунд до года)  */</span></div><div class="line">  <span class="stringliteral">&quot;resolution&quot;</span>: <span class="stringliteral">&quot;seconds&quot;</span>,</div><div class="line">  <span class="comment">/* Формат представления даты и времени в формате strftime (игнорируется если заданы resolution (от minutes и выше) или любые комбинации hide) */</span></div><div class="line">  <span class="stringliteral">&quot;datetime_format&quot;</span>: <span class="stringliteral">&quot;&quot;</span>,</div><div class="line">  <span class="comment">/* Перечисление скрываемых частей сообщения */</span></div><div class="line">  <span class="stringliteral">&quot;hide&quot;</span>: <span class="stringliteral">&quot;none&quot;</span>,</div><div class="line">  <span class="comment">/* Локаль */</span></div><div class="line">  <span class="stringliteral">&quot;locale&quot;</span>: <span class="stringliteral">&quot;&quot;</span>,</div><div class="line">  <span class="comment">/* Включить цветовую схему при записи в файл */</span></div><div class="line">  <span class="stringliteral">&quot;colorized&quot;</span>: <span class="stringliteral">&quot;none&quot;</span>,</div><div class="line">  <span class="comment">/* Карта цветов*/</span></div><div class="line">  <span class="stringliteral">&quot;color_map&quot;</span>: {},</div><div class="line"></div><div class="line">  <span class="comment">/* --- Кастомизация --- */</span></div><div class="line"></div><div class="line">  <span class="comment">/* Настройки стандартного вывода */</span></div><div class="line">  <span class="stringliteral">&quot;stdout&quot;</span>: { </div><div class="line">    <span class="comment">/* Возможные значения: cout, clog, cerr и # для запрета вывода */</span></div><div class="line">    <span class="stringliteral">&quot;name&quot;</span>:<span class="stringliteral">&quot;cout&quot;</span>,</div><div class="line">    <span class="comment">/* Делать flush после каждого сообщения */</span></div><div class="line">    <span class="stringliteral">&quot;sync&quot;</span>: <span class="keyword">false</span>,</div><div class="line">    <span class="comment">/* Включить цветовую схему при записи в stdout */</span></div><div class="line">    <span class="stringliteral">&quot;colorized&quot;</span>: <span class="stringliteral">&quot;all&quot;</span>,</div><div class="line">    <span class="comment">/* -- остальные опции форматирования -- */</span></div><div class="line">  },</div><div class="line">  <span class="comment">/* Настройки записи в системный лог */</span></div><div class="line">  <span class="stringliteral">&quot;syslog&quot;</span>: {</div><div class="line">    <span class="comment">/* Имя для syslog. Если не указан (по умолчанию) то запись в syslog не ведется*/</span></div><div class="line">    <span class="stringliteral">&quot;name&quot;</span>:<span class="stringliteral">&quot;&quot;</span></div><div class="line">  },</div><div class="line">  <span class="comment">/* Индивидуальные настройки для логов и типов сообщений */</span></div><div class="line">  <span class="stringliteral">&quot;customize&quot;</span>: [ <span class="comment">/* рассмотрим далее */</span> ]</div><div class="line">}</div></div><!-- fragment --><p> Минимальная конфигурация: </p><div class="fragment"><div class="line">{}</div></div><!-- fragment --><p> В этом случае запись в файл и syslog не производится, а вывод только в <code>std::cout</code> в цвете. Чтобы отключить раскраску: </p><div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;stdout&quot;</span>: { </div><div class="line">    <span class="stringliteral">&quot;colorized&quot;</span>: <span class="stringliteral">&quot;none&quot;</span>,</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p> Для записи в файл достаточно указать путь: </p><div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;path&quot;</span>:<span class="stringliteral">&quot;/path/to/log/file.log&quot;</span> </div><div class="line">}</div></div><!-- fragment --><p> Чтобы запретить вывод в stdout, а в файл выводить в цвете: </p><div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;path&quot;</span>:<span class="stringliteral">&quot;/path/to/log/file.log&quot;</span> </div><div class="line">  <span class="stringliteral">&quot;colorized&quot;</span>: <span class="stringliteral">&quot;none&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;stdout&quot;</span>: { </div><div class="line">    <span class="stringliteral">&quot;name&quot;</span>:<span class="stringliteral">&quot;#&quot;</span></div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p> Чтобы запретить запись сообщений конкретного лога или типов сообщений всех логов, нужно перечислить их в массиве <code>deny</code>, например для того чтобы отфильтровать "мусор" в Debug режиме: </p><div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;path&quot;</span>: <span class="stringliteral">&quot;/path/to/log/file.log&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;deny&quot;</span>: [<span class="stringliteral">&quot;DEBUG&quot;</span>, <span class="stringliteral">&quot;TRACE&quot;</span>]</div><div class="line">}</div></div><!-- fragment --><p> Чтобы разрешить запись сообщений конкретного лога или некоторые типы сообщений, нужно перечислить их в массиве <code>allow</code>, например для того чтобы разрешить только сообщения лога MYLOG, и сообщения ERROR остальных логов: </p><div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;path&quot;</span>: <span class="stringliteral">&quot;/path/to/log/file.log&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;allow&quot;</span>: [<span class="stringliteral">&quot;MYLOG&quot;</span>, <span class="stringliteral">&quot;ERROR&quot;</span>]</div><div class="line">}</div></div><!-- fragment --><p> Ускорить запись в лог примерно в три раза, но без гарантий в случае аварийных падений: </p><div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;path&quot;</span>: <span class="stringliteral">&quot;/path/to/log/file.log&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;sync&quot;</span>: <span class="keyword">false</span></div><div class="line">}</div></div><!-- fragment --> <h2>Настройки ротации</h2>
<p>По умолчанию запись происходит в один и тот же файл, без ограничений. Чтобы при каждом запуске запись происходила с начала файла: </p><div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;path&quot;</span>: <span class="stringliteral">&quot;/path/to/log/file.log&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;startup_rotate&quot;</span>: <span class="keyword">true</span></div><div class="line">}</div></div><!-- fragment --><p> Чтобы при этом сохранялся лог от предыдущего запуска в файле <code>/path/to/log/file.log.old-0</code>: </p><div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;path&quot;</span>: <span class="stringliteral">&quot;/path/to/log/file.log&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;startup_rotate&quot;</span>: <span class="keyword">true</span>, </div><div class="line">  <span class="stringliteral">&quot;rotation&quot;</span>: 1</div><div class="line">}</div></div><!-- fragment --><p> Без указанных ограничений на размер или время, значения <code>rotation</code> больше единицы не дают эффекта. Для обнуления файла при достижении заданного размера (1МБ): </p><div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;path&quot;</span>: <span class="stringliteral">&quot;/path/to/log/file.log&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;size_limit&quot;</span>: 1048576</div><div class="line">}</div></div><!-- fragment --><p> В следующий конфигурации при запуске, запись будет продолжена в указанный лог, но при достижении размера в 1МБ файл будет переименован '/path/to/log/file.log.old-0' и запись начнется с начала файла: </p><div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;path&quot;</span>: <span class="stringliteral">&quot;/path/to/log/file.log&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;size_limit&quot;</span>: 1048576, </div><div class="line">  <span class="stringliteral">&quot;rotation&quot;</span>: 1</div><div class="line">}</div></div><!-- fragment --><p> Запись в новый файл при запуске и сохранении истории в 10 файлов, с размером не более 1 МБ каждый: </p><div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;path&quot;</span>: <span class="stringliteral">&quot;/path/to/log/file.log&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;startup_rotate&quot;</span>: <span class="keyword">true</span>,</div><div class="line">  <span class="stringliteral">&quot;size_limit&quot;</span>: 1048576, </div><div class="line">  <span class="stringliteral">&quot;rotation&quot;</span>: 10</div><div class="line">}</div></div><!-- fragment --><p> Посуточная ротация файлов с историей за месяц: </p><div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;path&quot;</span>: <span class="stringliteral">&quot;/path/to/log/file.log&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;time_limit&quot;</span>: 86400, </div><div class="line">  <span class="stringliteral">&quot;rotation&quot;</span>: 30</div><div class="line">}</div></div><!-- fragment --><p> Посекундные срезы (например при трассировании трафика при большой нагрузке ): </p><div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;path&quot;</span>: <span class="stringliteral">&quot;/path/to/log/file.log&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;startup_rotate&quot;</span>: <span class="keyword">true</span>,</div><div class="line">  <span class="stringliteral">&quot;time_limit&quot;</span>: 1, </div><div class="line">  <span class="stringliteral">&quot;rotation&quot;</span>: 1024</div><div class="line">}</div></div><!-- fragment --><p>С помощью <code>unixtime_suffix</code> можно изменить алгоритм формирования файла с простого счетчика на unixtime, например <code>file-1521107160.log</code>. В случае падений или повторной инициализации счетчики сбрасываются и старые файлы не удаляются. В случае с обычными счетчиками они в конечном итоге перезапишутся, а при <code>unixtime</code> нужно удалять вручную. По умолчанию, при ротации, в начало и конец файла записывается дополнительная информация, которую можно с помощью опций <code>rotation_header</code> и <code>rotation_footer</code>: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;! ---------------- rotated ----------------</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;! Start time: Thu Mar 15 12:50:35 2018</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;! Summary size: 209</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;! Total Rotated: 1</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;! Previous log: ./example_j1.log</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;! -----------------------------------------</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;2018-03-15 12:50:35.255 WLOG   MESSAGE   Demo progress LOG</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;2018-03-15 12:50:35.255 WLOG   BEGIN     Progress...</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;2018-03-15 12:50:35.256 WLOG   WARNING   Test WARNING message №0</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;2018-03-15 12:50:36.398 WLOG   TRACE     Test TRACE message №1000</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;2018-03-15 12:50:37.548 WLOG   DEBUG     Test DEBUG message №2000</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;2018-03-15 12:50:41.002 WLOG   BEGIN     Test BEGIN message №5000</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;2018-03-15 12:50:42.154 WLOG   END       Test END message №6000</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;2018-03-15 12:50:43.304 WLOG   MESSAGE   Test MESSAGE message №7000</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;2018-03-15 12:50:44.455 EXAMPL MESSAGE   Test MESSAGE message №8000</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;2018-03-15 12:50:45.607 EXAMPL WARNING   Test WARNING message №9000</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;! ---------------- rotated ----------------</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;! Start time: Thu Mar 15 12:50:35 2018</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;! Summary size: 1067</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;! Total Rotated: 1</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;! Previous log: ./example_j1.log</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;! -----------------------------------------</div></div><!-- fragment --><h1>Настройки форматирования</h1>
<p>Для отображения долей секунд используется опция <code>resolution</code> со следующими значениями: <code>seconds</code> (без долей), <code>deciseconds</code>, <code>centiseconds</code>, <code>milliseconds</code>, <code>microseconds</code> или <code>nanoseconds</code>, например: </p><div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;path&quot;</span>: <span class="stringliteral">&quot;/path/to/log/file.log&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;resolution&quot;</span>: <span class="stringliteral">&quot;milliseconds&quot;</span></div><div class="line">}</div></div><!-- fragment --><p>Изменить отображение даты и времени можно с помощью дополнительных значений <code>resolution</code>: <code>minutes</code>, <code>hours</code>, <code>days</code>, <code>month</code>, <code>year</code> которые влияют на отображение информации, также как опция <code>hide</code>. Опция <code>hide</code> позволяет скрыть несколько частей сообщения в любой комбинации. Таблица возможных значений для <code>hide</code>:</p><ul>
<li><code>date</code> - все поле даты</li>
<li><code>time</code> - все поле времени</li>
<li><code>year</code> - год в поле даты</li>
<li><code>month</code> - месяц в поле даты</li>
<li><code>weekday</code> - день недели в поле даты</li>
<li><code>days</code> - день месяца в поле даты</li>
<li><code>hours</code> - часы в поле времени</li>
<li><code>minutes</code> - минуты в поле времени</li>
<li><code>seconds</code> - секунды в поле времени</li>
<li><code>fraction</code> - доли секунды</li>
<li><code>name</code> - имя лога</li>
<li><code>ident</code> - идентификатор сообщения</li>
<li><code>message</code> - текст сообщения</li>
</ul>
<p>Значения частично скрывающие поля даты и времени влияют на формат отображения этих полей. Частично <code>hide</code> перекрывают <code>resolution</code>. Общая рекомендация - если необходимого представления возможно добиться с помощью опции <code>resolution</code>, то используем ее.</p>
<p>Далее, для удобства, отдельно приведены таблицы для полей даты и времени.</p>
<p>Возможные комбинации для <code>hide</code> и аналогичные <code>resolution</code> для поля времени с примерами отображения:</p>
<table class="doxtable">
<tr>
<th width="20%">hide </th><th width="20%">resolution </th><th>Пример отображения  </th></tr>
<tr>
<td></td><td>milliseconds </td><td>18:36:12.805  </td></tr>
<tr>
<td>fraction </td><td>seconds </td><td>18:36:12  </td></tr>
<tr>
<td>fraction|seconds </td><td>minutes </td><td>18:36  </td></tr>
<tr>
<td>fraction|seconds|minutes </td><td>hours </td><td>18h  </td></tr>
</table>
<p>Следующий вывод можно добиться только с помощью <code>hide</code> для <code>resolution</code>==<code>milliseconds</code>:</p>
<table class="doxtable">
<tr>
<th width="20%">hide </th><th width="20%">Пример отображения </th><th>Комментарий  </th></tr>
<tr>
<td>hours </td><td>01m 55s.405  </td><td>Сомнительно. Например при поминутных слепках.  </td></tr>
<tr>
<td>hours|minutes  </td><td>1514304173.456  </td><td>Если нужен unixtime.  </td></tr>
<tr>
<td>hours|minutes|fraction </td><td>1514304173 </td><td>Если нужен unixtime&gt;. Но лучше <b>hide=hours|minutes и resolution=seconds</b> </td></tr>
<tr>
<td>hours|minutes|seconds  </td><td>.456  </td><td>Бесполезно.  </td></tr>
<tr>
<td>hours|seconds  </td><td>26m.37642  </td><td>Сомнительно (доли минуты в resolution). Например при поминутных слепках.  </td></tr>
<tr>
<td>minutes|seconds  </td><td>19h.1631487  </td><td>Сомнительно (доли часа в resolution). Например при часовых слепках.  </td></tr>
</table>
<p>Возможные комбинации для <code>hide</code> и аналогичные <code>resolution</code> для поля времени с примерами вывода:</p>
<table class="doxtable">
<tr>
<th width="20%">hide </th><th width="20%">resolution </th><th>Пример отображения  </th></tr>
<tr>
<td>time </td><td>days </td><td>2017-12-27   </td></tr>
<tr>
<td>time|days </td><td>month </td><td>2017 Dec  </td></tr>
<tr>
<td>time|days|month </td><td>year </td><td>2017  </td></tr>
</table>
<p>Следующий вывод даты можно добиться только с помощью <code>hide</code>:</p>
<table class="doxtable">
<tr>
<th width="20%">hide </th><th width="20%">Пример отображения </th><th>Комментарий  </th></tr>
<tr>
<td>year </td><td>Wed Dec 27 </td><td></td></tr>
<tr>
<td>year|month  </td><td>Wed 27 </td><td></td></tr>
<tr>
<td>year|month|weekday </td><td>27 </td><td></td></tr>
<tr>
<td>month  </td><td>27 Wed 2017 </td><td></td></tr>
<tr>
<td>day  </td><td>2017 Dec </td><td></td></tr>
<tr>
<td>minutes|seconds  </td><td>19h.1631487 </td><td></td></tr>
</table>
<p>Пример:</p>
<div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;path&quot;</span>: <span class="stringliteral">&quot;/path/to/log/file.log&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;resolution&quot;</span>: <span class="stringliteral">&quot;milliseconds&quot;</span>, </div><div class="line">  <span class="stringliteral">&quot;hide&quot;</span>:<span class="stringliteral">&quot;year|month|seconds&quot;</span></div><div class="line">}</div></div><!-- fragment --><div class="fragment"><div class="line">wlog::logger_options opt;</div><div class="line">opt.path=<span class="stringliteral">&quot;/path/to/log/file.log&quot;</span>;</div><div class="line">opt.resolution = wlog::resolutions::milliseconds;</div><div class="line">opt.hide = wlog::hide_flags::year|wlog::hide_flags::month|wlog::hide_flags::seconds;</div></div><!-- fragment --><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Wed 27 17:53.17548 WLOG DEBUG Тестовое DEBUG сообщение №22000</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;Wed 27 17:53.18734 WLOG ERROR Тестовое ERROR сообщение №23000</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Wed 27 17:53.19914 WLOG FATAL Тестовое FATAL сообщение №24000</div></div><!-- fragment --><h2>Локализация</h2>
<p>Для представления даты и времени в формате strftime можно с помощью опции <code>datetime_format</code>. Но нужно иметь ввиду, что в этом случае нельзя использовать <code>resolution</code> со значениями <code>minutes</code>, <code>hours</code>, <code>days</code>, <code>month</code>, <code>year</code> и любые комбинации hide. Для <code>resolution</code> со значениями <code>deciseconds</code>, <code>centiseconds</code>, <code>milliseconds</code>, <code>microseconds</code> или <code>nanoseconds</code>доли секунды записываются сразу после строки времени через разделитель.</p>
<p>Для локализации отображения <code>datetime_format</code> используется, соответственно, <code>locale</code>. Задана только <code>locale</code>, но не заданы другие опции форматирования даты и времени, то <code>datetime_format == "%c"</code></p>
<div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;path&quot;</span>: <span class="stringliteral">&quot;/path/to/log/file.log&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;resolution&quot;</span>: <span class="stringliteral">&quot;milliseconds&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;locale&quot;</span>: <span class="stringliteral">&quot;ru_RU.UTF-8&quot;</span></div><div class="line">}</div></div><!-- fragment --><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Ср 27 дек 2017 18:03:29,864 EXAMPLE [DEBUG] Тестовое DEBUG сообщение №11000</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;Ср 27 дек 2017 18:03:31,144 EXAMPLE [ERROR] Тестовое ERROR сообщение №12000</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Ср 27 дек 2017 18:03:32,426 EXAMPLE [FATAL] Тестовое FATAL сообщение №13000</div></div><!-- fragment --><div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;path&quot;</span>: <span class="stringliteral">&quot;/path/to/log/file.log&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;resolution&quot;</span>: <span class="stringliteral">&quot;milliseconds&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;locale&quot;</span>: <span class="stringliteral">&quot;en_US.UTF-8&quot;</span></div><div class="line">}</div></div><!-- fragment --><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Wed 27 Dec 2017 06:04:35 PM MSK.057 WLOG TRACE Тестовое TRACE сообщение №1000</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;Wed 27 Dec 2017 06:04:36 PM MSK.331 WLOG DEBUG Тестовое DEBUG сообщение №2000</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Wed 27 Dec 2017 06:04:37 PM MSK.608 WLOG ERROR Тестовое ERROR сообщение №3000</div></div><!-- fragment --><h1>Настройки STDOUT</h1>
<p>Наследует и/или переопределяет все настройки форматирования. Если опция определена в секции <code>stdout</code> то используется она, если нет, то опция из основной секции или значение по умолчанию. Исключение составляет опция <code>colorized</code>, у которой в основной секции по умолчанию значение <code>none</code>, но если она не определен в секции <code>stdout</code>, то по умолчанию значение <code>all</code>. Иными словами, по умолчанию, в основной лог запись идет без цветовой раскраски, а на экран в цвете. Также по умолчанию <code>sync</code> отключена и не наследуется.</p>
<div class="fragment"><div class="line">{</div><div class="line">  <span class="comment">/* ... */</span></div><div class="line">  <span class="stringliteral">&quot;stdout&quot;</span>: {</div><div class="line">    <span class="comment">/* Имя стандартного вывода (cout, cerr, clog)*/</span></div><div class="line">    <span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;cout&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;sync&quot;</span>: <span class="keyword">false</span>,</div><div class="line">    <span class="stringliteral">&quot;name_width&quot;</span>: 6,</div><div class="line">    <span class="stringliteral">&quot;ident_width&quot;</span>: 9,</div><div class="line">    <span class="stringliteral">&quot;resolution&quot;</span>: <span class="stringliteral">&quot;seconds&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;datetime_format&quot;</span>: <span class="stringliteral">&quot;&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;hide&quot;</span>: <span class="stringliteral">&quot;&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;locale&quot;</span>: <span class="stringliteral">&quot;&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;colorized&quot;</span>: <span class="stringliteral">&quot;all&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;color_map&quot;</span>: {}</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p>Если в основной секции определены <code>datetime_format</code> или <code>locale</code>, но вы не хотите их наследовать то используйте значение <code>#</code>, а для <code>resolution</code> и <code>colorized</code> - <code>none</code>. Здесь основная идея в том, что как правило нет нужды применять разное форматирование для файлов и stdout, но если очень хочется, то можно. Чаще всего требуется отключить цветовую раскраску или изменить stdout, а в остальном применяется такое же форматирование как и для файлов.</p>
<h1>Кастомные настройки логов</h1>
<p>Для каждого лога, набра логов и даже типов сообщений, можно применить собственный набор настроек форматирования и ротации. </p><div class="fragment"><div class="line">{</div><div class="line">  <span class="comment">/* --- основные настройки --- */</span></div><div class="line">  <span class="stringliteral">&quot;customize&quot;</span>: [ </div><div class="line">    {</div><div class="line">      <span class="stringliteral">&quot;names&quot;</span>:[<span class="stringliteral">&quot;DEBUG&quot;</span>, <span class="stringliteral">&quot;MYLOG&quot;</span>],</div><div class="line">      <span class="comment">/* здесь доступны все опции основной секции, за исключением customize*/</span></div><div class="line">    }</div><div class="line">  ]</div><div class="line">}</div></div><!-- fragment --><p>Чтобы вывести DEBUG и TRACE сообщения в отдельный файл: </p><div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;path&quot;</span>: <span class="stringliteral">&quot;/path/to/log/file.log&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;customize&quot;</span>: [ </div><div class="line">    {</div><div class="line">      <span class="stringliteral">&quot;names&quot;</span>:[<span class="stringliteral">&quot;DEBUG&quot;</span>, <span class="stringliteral">&quot;TRACE&quot;</span>],</div><div class="line">      <span class="stringliteral">&quot;path&quot;</span>: <span class="stringliteral">&quot;/path/to/log/file-Debug.log&quot;</span>,</div><div class="line">      <span class="stringliteral">&quot;sync&quot;</span>:<span class="keyword">false</span>,</div><div class="line">      <span class="stringliteral">&quot;startup_rotate&quot;</span>: <span class="keyword">true</span>,</div><div class="line">      <span class="stringliteral">&quot;size_limit&quot;</span>: 1048576,</div><div class="line">      <span class="stringliteral">&quot;rotation&quot;</span>: 1,</div><div class="line">      <span class="stringliteral">&quot;stdout&quot;</span>:{<span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;#&quot;</span>}</div><div class="line">    }</div><div class="line">  ]</div><div class="line">}</div></div><!-- fragment --><p> Здесь в основной файл будет производиться без ротации, а в file-Debug.log ограничение в 1МБ. Также запрещаем выводить эти сообщения в stdout, и отключаем синхронную запись для ускорения. Если не указывать путь, то запись будет вестись в основной файл. Чтобы отладочные сообщения выводить только на экран, а все остальные только в файл: </p><div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;path&quot;</span>: <span class="stringliteral">&quot;/path/to/log/file.log&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;stdout&quot;</span>:{<span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;#&quot;</span>}</div><div class="line">  <span class="stringliteral">&quot;customize&quot;</span>: [ </div><div class="line">  {</div><div class="line">    <span class="stringliteral">&quot;names&quot;</span>:[<span class="stringliteral">&quot;DEBUG&quot;</span>, <span class="stringliteral">&quot;TRACE&quot;</span>],</div><div class="line">    <span class="stringliteral">&quot;path&quot;</span>: <span class="stringliteral">&quot;#&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;stdout&quot;</span>:{<span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;cerr&quot;</span>}</div><div class="line">  }</div><div class="line">  ]</div><div class="line">}</div></div><!-- fragment --><p> Можно выводить все сообщения лога в отдельный файл, или каждый тип сообщений по разным файлам указав в знак $ вместо пути: </p><div class="fragment"><div class="line">{</div><div class="line">  <span class="comment">/* запрещаем DEBUG и TRACE сообщения </span></div><div class="line"><span class="comment">  &quot;deny&quot;: [&quot;DEBUG&quot;, &quot;TRACE&quot;],</span></div><div class="line"><span class="comment">  &quot;path&quot;: &quot;/path/to/log/file.log&quot;,</span></div><div class="line"><span class="comment">  &quot;customize&quot;: [ </span></div><div class="line"><span class="comment">    {</span></div><div class="line"><span class="comment">      /* Для всех сообщений MYLOG, включая DEBUG и TRACE*/</span></div><div class="line">      <span class="stringliteral">&quot;names&quot;</span>:[<span class="stringliteral">&quot;MYLOG1&quot;</span>, <span class="stringliteral">&quot;MYLOG2&quot;</span>],</div><div class="line">      <span class="comment">/* но исключая PROGRESS */</span></div><div class="line">      <span class="stringliteral">&quot;deny&quot;</span>: [<span class="stringliteral">&quot;PROGRESS&quot;</span>],</div><div class="line">      <span class="comment">/* пишем в /path/to/log/file-MYLOG1.log и /path/to/log/file-MYLOG1.log */</span></div><div class="line">      <span class="stringliteral">&quot;path&quot;</span>:<span class="stringliteral">&quot;$&quot;</span></div><div class="line">    },</div><div class="line">    {</div><div class="line">      <span class="comment">/* Для всех сообщений MYLOG, включая DEBUG и TRACE*/</span></div><div class="line">      <span class="stringliteral">&quot;names&quot;</span>:[<span class="stringliteral">&quot;MYLOG3&quot;</span>, <span class="stringliteral">&quot;MYLOG4&quot;</span>],</div><div class="line">      <span class="comment">/* пишем MYLOG3 и MYLOG4 в /path/to/log/file-MYLOG34.log */</span></div><div class="line">      <span class="stringliteral">&quot;path&quot;</span>:<span class="stringliteral">&quot;$MYLOG34&quot;</span></div><div class="line">    },    {</div><div class="line">      <span class="comment">// все сообщения &quot;PROGRESS&quot; выводим только в stdout</span></div><div class="line">      <span class="stringliteral">&quot;names&quot;</span>:[<span class="stringliteral">&quot;PROGRESS&quot;</span>],</div><div class="line">      <span class="stringliteral">&quot;path&quot;</span>:<span class="stringliteral">&quot;#&quot;</span></div><div class="line">    }</div><div class="line">  ]</div><div class="line">}</div></div><!-- fragment --><p> Обратите внимание все сообщения заблокированные <code>deny</code> в секции <code>customize</code>, не отбрасываются, поэтому сообщения PROGRESS будут писаться в основной лог, если не сделать отдельную кастомизацию.</p>
<h2>настройки syslog</h2>
<p>Для записи в syslog достаточно задать имя в соответствующей секции конфигурации, однако в этом случае в syslog будут писаться все сообщения всех логов, что и в основной файл, а не только лога SYSLOG. Чтобы исправить это: </p><div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;path&quot;</span>: <span class="stringliteral">&quot;/path/to/log/file.log&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;customize&quot;</span>: [</div><div class="line">    {</div><div class="line">      <span class="stringliteral">&quot;names&quot;</span>:[<span class="stringliteral">&quot;SYSLOG&quot;</span>],</div><div class="line">      <span class="stringliteral">&quot;syslog&quot;</span>:{</div><div class="line">        <span class="stringliteral">&quot;name&quot;</span>:<span class="stringliteral">&quot;myprj&quot;</span></div><div class="line">      }</div><div class="line">    }</div><div class="line">  ]</div><div class="line">}</div></div><!-- fragment --><h1>Цветовая схема</h1>
<p>Для управление цветовой схемой используются опции <code>colorized</code>(для указания раскраски элементов записи лога) и <code>color_map</code>(для изменения цветовой схемы). Значения <code>colorized</code>:</p><ul>
<li>none - отключить раскраску</li>
<li>date - дата</li>
<li>time - время</li>
<li>fraction - доли секунды</li>
<li>name - имя лога</li>
<li>notice - тип сообщения</li>
<li>ident - тип сообщения</li>
<li>message - текст сообщения (если не задан в color_map, то в цвет ident)</li>
<li>all - включить в раскраску все элементы</li>
</ul>
<p>Для цветовой схемы, в качестве ключа используется имя лога, тип сообщения или одно из специальных значений:</p><ul>
<li>$all - всю строку одним цветом (например чтобы выделить ошибку)</li>
<li>$date - цвет даты</li>
<li>$time - цвет времени</li>
<li>$fraction - доли секунды</li>
<li>$name - цвет имени лога</li>
<li>$ident - цвет типа сообщения</li>
<li>$message - цвет текста сообщения</li>
</ul>
<p>В качестве значения номер цвета, или его названия </p><table class="doxtable">
<tr>
<th></th><th></th></tr>
<tr>
<td>black </td><td>30 </td></tr>
<tr>
<td>red </td><td>31 </td></tr>
<tr>
<td>green </td><td>32 </td></tr>
<tr>
<td>brown </td><td>33 </td></tr>
<tr>
<td>blue </td><td>34 </td></tr>
<tr>
<td>magenta </td><td>35 </td></tr>
<tr>
<td>cyan </td><td>36 </td></tr>
<tr>
<td>gray </td><td>37 </td></tr>
<tr>
<td>dark_gray </td><td>90 </td></tr>
<tr>
<td>light_red </td><td>91 </td></tr>
<tr>
<td>light_green </td><td>92 </td></tr>
<tr>
<td>yellow </td><td>93 </td></tr>
<tr>
<td>light_blue </td><td>94 </td></tr>
<tr>
<td>light_magenta </td><td>95 </td></tr>
<tr>
<td>light_cyan </td><td>96 </td></tr>
<tr>
<td>white </td><td>97 </td></tr>
</table>
<p>Раскрашиваем имя лога MYLOG в пурпурный цвет :</p>
<div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;stdout&quot;</span>: {</div><div class="line">    <span class="stringliteral">&quot;color_map&quot;</span>:{<span class="stringliteral">&quot;MYLOG&quot;</span>:<span class="stringliteral">&quot;light_magenta&quot;</span>}</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p>Делаем для сообщений FATAL красный фон:</p>
<div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;customize&quot;</span>: [</div><div class="line">    {</div><div class="line">      <span class="stringliteral">&quot;names&quot;</span>:[<span class="stringliteral">&quot;FATAL&quot;</span>],</div><div class="line">      <span class="stringliteral">&quot;stdout&quot;</span>: {</div><div class="line">        <span class="stringliteral">&quot;color_map&quot;</span>:{<span class="stringliteral">&quot;$all&quot;</span>:<span class="stringliteral">&quot;41&quot;</span>}</div><div class="line">      }</div><div class="line">    }</div><div class="line">  ]</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Создано системой &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
